<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, MultiParamTypeClasses #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Module      :  Crypto.Nettle.UMAC</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- Copyright   :  (c) 2013 Stefan B&#252;hler</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- License     :  MIT-style (see the file COPYING)</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- </span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Maintainer  :  stbuehler@web.de</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- This module exports the UMAC algorithms supported by nettle:</span><span>
</span><a name="line-14"></a><span class="hs-comment">--   &lt;http://www.lysator.liu.se/~nisse/nettle/&gt;</span><span>
</span><a name="line-15"></a><span class="hs-comment">--</span><span>
</span><a name="line-16"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Nettle</span><span class="hs-operator">.</span><span class="hs-identifier">UMAC</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-19"></a><span>	  </span><span class="hs-identifier">UMAC</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">UMAC32</span><span>
</span><a name="line-21"></a><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">UMAC64</span><span>
</span><a name="line-22"></a><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">UMAC96</span><span>
</span><a name="line-23"></a><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">UMAC128</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">umacInitKeyedHash</span><span>
</span><a name="line-26"></a><span>	</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">SecureMem</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Tagged</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;$&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Nettle.Utils.html"><span class="hs-identifier">Nettle</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Crypto.Nettle.KeyedHash.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Nettle</span><span class="hs-operator">.</span><span class="hs-identifier">KeyedHash</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Crypto.Nettle.Hash.ForeignImports.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Nettle</span><span class="hs-operator">.</span><span class="hs-identifier">Hash</span><span class="hs-operator">.</span><span class="hs-identifier">ForeignImports</span></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">-- internal functions are not camelCase on purpose</span><span>
</span><a name="line-41"></a><span class="hs-pragma">{-# ANN module &quot;HLint: ignore Use camelCase&quot; #-}</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">{-|
'UMAC' is a class of keyed hash algorithms that take an additional nonce.

Keys for 'UMAC' are always 16 bytes; there are different digest sizes: 4, 8, 12 and 16 bytes (32, 64, 96 and 128 bits),
and the variants are named after the digest length in bits.

On initialization the nonce is set to 0; each finalize returns a new state with an incremented nonce.
The nonce is interpreted as 16-byte (128-bit) big-endian integer (and for string shorter than 16 bytes padded with zeroes /on the left/; setting empty nonces is not allowed).
-}</span><span>
</span><a name="line-52"></a><span class="hs-keyword">class</span><span> </span><a name="UMAC"><a href="Crypto.Nettle.UMAC.html#UMAC"><span class="hs-identifier">UMAC</span></a></a><span> </span><a name="local-6989586621679046467"><a href="#local-6989586621679046467"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-53"></a><span>	</span><span class="hs-comment">-- | digest size in bytes</span><span>
</span><a name="line-54"></a><span>	</span><span class="hs-identifier">umacDigestSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-55"></a><span>	</span><span class="hs-comment">-- | umac name (&quot;UMAC&quot; ++ digest size in bits)</span><span>
</span><a name="line-56"></a><span>	</span><span class="hs-identifier">umacName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier">String</span><span>
</span><a name="line-57"></a><span>	</span><span class="hs-identifier">umacName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-string">&quot;UMAC&quot;</span><span> </span><span class="hs-operator">++</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">8</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">umacDigestSize</span><span>
</span><a name="line-58"></a><span>	</span><span class="hs-comment">-- | initialize a new context from a @key@ with a zero @nonce@</span><span>
</span><a name="line-59"></a><span>	</span><span class="hs-identifier">umacInit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">B</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-comment">{- ^ @key@ argument -}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">u</span><span>
</span><a name="line-60"></a><span>	</span><span class="hs-comment">-- | set a @nonce@; can be called anytime before producing the digest</span><span>
</span><a name="line-61"></a><span>	</span><span class="hs-identifier">umacSetNonce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-comment">{- ^ @nonce@ argument -}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">u</span><span>
</span><a name="line-62"></a><span>	</span><span class="hs-comment">-- | append @message@ data to be hashed</span><span>
</span><a name="line-63"></a><span>	</span><span class="hs-identifier">umacUpdate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-comment">{- ^ @message@ argument -}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">u</span><span>
</span><a name="line-64"></a><span>	</span><span class="hs-comment">-- | append lazy @message@ data to be hashed</span><span>
</span><a name="line-65"></a><span>	</span><span class="hs-identifier">umacUpdateLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">L</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-comment">{- ^ @message@ argument -}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">u</span><span>
</span><a name="line-66"></a><span>	</span><span class="hs-identifier">umacUpdateLazy</span><span> </span><a name="local-8214565720323821363"><a href="Crypto.Nettle.UMAC.html#umacUpdateLazy"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldl'</span><span> </span><span class="hs-identifier">umacUpdate</span><span> </span><a href="Crypto.Nettle.UMAC.html#umacUpdate"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="Crypto.Nettle.UMAC.html#umacUpdate"><span class="hs-operator hs-var">.</span></a><span> </span><a href="Crypto.Nettle.UMAC.html#umacUpdate"><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span></a><span class="hs-identifier">toChunks</span><span>
</span><a name="line-67"></a><span>	</span><span class="hs-comment">-- | produce a digest, and return a new state with incremented nonce</span><span>
</span><a name="line-68"></a><span>	</span><span class="hs-identifier">umacFinalize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B</span><a href="#local-6989586621679046467"><span class="hs-operator hs-type">.</span></a><span class="hs-identifier">ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">u</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-comment">-- make all (UMAC u) a (KeyedHashAlgorithm u u)</span><span>
</span><a name="line-71"></a><span class="hs-identifier">umacKHDigestSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC"><span class="hs-identifier hs-type">UMAC</span></a><span> </span><a href="#local-6989586621679047138"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679047138"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-72"></a><a name="umacKHDigestSize"><a href="Crypto.Nettle.UMAC.html#umacKHDigestSize"><span class="hs-identifier">umacKHDigestSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Nettle.UMAC.html#umacDigestSize"><span class="hs-identifier hs-var">umacDigestSize</span></a><span>
</span><a name="line-73"></a><span class="hs-identifier">umacKHName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC"><span class="hs-identifier hs-type">UMAC</span></a><span> </span><a href="#local-6989586621679047137"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679047137"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-74"></a><a name="umacKHName"><a href="Crypto.Nettle.UMAC.html#umacKHName"><span class="hs-identifier">umacKHName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Nettle.UMAC.html#umacName"><span class="hs-identifier hs-var">umacName</span></a><span>
</span><a name="line-75"></a><span class="hs-identifier">umacKHInit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC"><span class="hs-identifier hs-type">UMAC</span></a><span> </span><a href="#local-6989586621679047136"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679047136"><span class="hs-identifier hs-type">u</span></a><span>
</span><a name="line-76"></a><a name="umacKHInit"><a href="Crypto.Nettle.UMAC.html#umacKHInit"><span class="hs-identifier">umacKHInit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Nettle.UMAC.html#umacInit"><span class="hs-identifier hs-var">umacInit</span></a><span>
</span><a name="line-77"></a><span class="hs-identifier">umacKHUpdate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC"><span class="hs-identifier hs-type">UMAC</span></a><span> </span><a href="#local-6989586621679047135"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679047135"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679047135"><span class="hs-identifier hs-type">u</span></a><span>
</span><a name="line-78"></a><a name="umacKHUpdate"><a href="Crypto.Nettle.UMAC.html#umacKHUpdate"><span class="hs-identifier">umacKHUpdate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Nettle.UMAC.html#umacUpdate"><span class="hs-identifier hs-var">umacUpdate</span></a><span>
</span><a name="line-79"></a><span class="hs-identifier">umacKHFinalize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC"><span class="hs-identifier hs-type">UMAC</span></a><span> </span><a href="#local-6989586621679047134"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679047134"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-80"></a><a name="umacKHFinalize"><a href="Crypto.Nettle.UMAC.html#umacKHFinalize"><span class="hs-identifier">umacKHFinalize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Nettle.UMAC.html#umacFinalize"><span class="hs-identifier hs-var">umacFinalize</span></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">{-|
The default 'KeyedHash' generated for UMAC 'KeyedHashAlgorithm' instances use a zero nonce; to set a different nonce you need to use this initialization function (or use the 'UMAC' interface).

Once the UMAC lives as 'KeyedHash' the nonce cannot be changed anymore, as 'KeyedHash' hides all internal state.
-}</span><span>
</span><a name="line-87"></a><span class="hs-identifier">umacInitKeyedHash</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Nettle.UMAC.html#UMAC"><span class="hs-identifier hs-type">UMAC</span></a><span> </span><a href="#local-6989586621679047133"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Nettle.Hash.Types.html#KeyedHashAlgorithm"><span class="hs-identifier hs-type">KeyedHashAlgorithm</span></a><span> </span><a href="#local-6989586621679047133"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-comment">{- ^ @key@ argument -}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-comment">{- ^ @nonce@ argument -}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679047133"><span class="hs-identifier hs-type">u</span></a><span> </span><a href="Crypto.Nettle.Hash.Types.html#KeyedHash"><span class="hs-identifier hs-type">KeyedHash</span></a><span>
</span><a name="line-88"></a><a name="umacInitKeyedHash"><a href="Crypto.Nettle.UMAC.html#umacInitKeyedHash"><span class="hs-identifier">umacInitKeyedHash</span></a></a><span> </span><a name="local-6989586621679047154"><a href="#local-6989586621679047154"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621679047155"><a href="#local-6989586621679047155"><span class="hs-identifier">nonce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Nettle.Hash.Types.html#KeyedHash"><span class="hs-identifier hs-var">KeyedHash</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Crypto.Nettle.UMAC.html#umacSetNonce"><span class="hs-identifier hs-var">umacSetNonce</span></a><span> </span><a href="#local-6989586621679047155"><span class="hs-identifier hs-var">nonce</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">tagSelf</span><span> </span><span class="hs-special">(</span><a href="Crypto.Nettle.UMAC.html#umacInit"><span class="hs-identifier hs-var">umacInit</span></a><span> </span><a href="#local-6989586621679047154"><span class="hs-identifier hs-var">key</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-keyword">class</span><span> </span><a name="NettleUMAC"><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier">NettleUMAC</span></a></a><span> </span><a name="local-6989586621679046466"><a href="#local-6989586621679046466"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-91"></a><span>	</span><span class="hs-identifier">nu_ctx_size</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-92"></a><span>	</span><span class="hs-identifier">nu_digest_size</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-93"></a><span>	</span><span class="hs-identifier">nu_set_key</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>	</span><span class="hs-identifier">nu_set_nonce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>	</span><span class="hs-identifier">nu_update</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>	</span><span class="hs-identifier">nu_digest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>	</span><span class="hs-identifier">nu_ctx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SecureMem</span><span>
</span><a name="line-98"></a><span>	</span><span class="hs-identifier">nu_Ctx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">SecureMem</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">u</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-identifier">nettleUmacDigestSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="#local-6989586621679047132"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-6989586621679047132"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-101"></a><a name="nettleUmacDigestSize"><a href="Crypto.Nettle.UMAC.html#nettleUmacDigestSize"><span class="hs-identifier">nettleUmacDigestSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Nettle.UMAC.html#nu_digest_size"><span class="hs-identifier hs-var">nu_digest_size</span></a><span>
</span><a name="line-102"></a><span class="hs-identifier">nettleUmacInit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="#local-6989586621679047131"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679047131"><span class="hs-identifier hs-type">u</span></a><span>
</span><a name="line-103"></a><a name="nettleUmacInit"><a href="Crypto.Nettle.UMAC.html#nettleUmacInit"><span class="hs-identifier">nettleUmacInit</span></a></a><span> </span><a name="local-6989586621679047156"><a href="#local-6989586621679047156"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679047156"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">16</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;wrong key length&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">untag</span><span> </span><a href="#local-6989586621679047157"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">NettleUMAC</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier hs-type">u</span><span>
</span><a name="line-105"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-106"></a><span>		</span><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">nu_ctx_size</span><span>
</span><a name="line-107"></a><span>		</span><span class="hs-identifier">set_key</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">nu_set_key</span><span>
</span><a name="line-108"></a><span>		</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">nu_Ctx</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">unsafeCreateSecureMem</span><span> </span><span class="hs-identifier hs-var">size</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-109"></a><span>			</span><span class="hs-identifier">withByteStringPtr</span><span> </span><span class="hs-identifier">key</span><span> </span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-identifier hs-var">keyptr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-110"></a><span>			</span><span class="hs-identifier">set_key</span><span> </span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-identifier">keyptr</span><span>
</span><a name="line-111"></a><span class="hs-identifier">nettleUmacSetNonce</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="#local-6989586621679047130"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679047130"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679047130"><span class="hs-identifier hs-type">u</span></a><span>
</span><a name="line-112"></a><a name="nettleUmacSetNonce"><a href="Crypto.Nettle.UMAC.html#nettleUmacSetNonce"><span class="hs-identifier">nettleUmacSetNonce</span></a></a><span> </span><a name="local-6989586621679047177"><a href="#local-6989586621679047177"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679047178"><a href="#local-6989586621679047178"><span class="hs-identifier">nonce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679047178"><span class="hs-identifier hs-var">nonce</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679047178"><span class="hs-identifier hs-var">nonce</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">16</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;invalid nonce length&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">untag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679047179"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679047177"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-113"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">NettleUMAC</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier hs-type">u</span><span>
</span><a name="line-114"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-115"></a><span>		</span><span class="hs-identifier">set_nonce</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">nu_set_nonce</span><span>
</span><a name="line-116"></a><span>		</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">nu_Ctx</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">unsafeDupablePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-117"></a><span>			</span><span class="hs-identifier">withSecureMemCopy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nu_ctx</span><span> </span><span class="hs-identifier hs-var">ctx</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-118"></a><span>			</span><span class="hs-identifier">withByteStringPtr</span><span> </span><span class="hs-identifier">nonce</span><span> </span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-identifier hs-var">noncelen</span></a><span> </span><span class="hs-identifier">nonceptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-119"></a><span>				</span><span class="hs-identifier">set_nonce</span><span> </span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-identifier">noncelen</span><span> </span><span class="hs-identifier">nonceptr</span><span>
</span><a name="line-120"></a><span class="hs-identifier">nettleUmacUpdate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="#local-6989586621679047129"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679047129"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679047129"><span class="hs-identifier hs-type">u</span></a><span>
</span><a name="line-121"></a><a name="nettleUmacUpdate"><a href="Crypto.Nettle.UMAC.html#nettleUmacUpdate"><span class="hs-identifier">nettleUmacUpdate</span></a></a><span> </span><a name="local-6989586621679047186"><a href="#local-6989586621679047186"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679047187"><a href="#local-6989586621679047187"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">untag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679047188"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679047186"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">NettleUMAC</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier hs-type">u</span><span>
</span><a name="line-123"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-124"></a><span>		</span><span class="hs-identifier">update</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">nu_update</span><span>
</span><a name="line-125"></a><span>		</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">nu_Ctx</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">unsafeDupablePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-126"></a><span>			</span><span class="hs-identifier">withSecureMemCopy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nu_ctx</span><span> </span><span class="hs-identifier hs-var">ctx</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-127"></a><span>			</span><span class="hs-identifier">withByteStringPtr</span><span> </span><span class="hs-identifier">msg</span><span> </span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-identifier hs-var">msglen</span></a><span> </span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-identifier hs-var">msgptr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-128"></a><span>				</span><span class="hs-identifier">update</span><span> </span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-identifier">msglen</span><span> </span><span class="hs-identifier">msgptr</span><span>
</span><a name="line-129"></a><span class="hs-identifier">nettleUmacUpdateLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="#local-6989586621679047128"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679047128"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679047128"><span class="hs-identifier hs-type">u</span></a><span>
</span><a name="line-130"></a><a name="nettleUmacUpdateLazy"><a href="Crypto.Nettle.UMAC.html#nettleUmacUpdateLazy"><span class="hs-identifier">nettleUmacUpdateLazy</span></a></a><span> </span><a name="local-6989586621679047195"><a href="#local-6989586621679047195"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679047196"><a href="#local-6989586621679047196"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">untag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679047197"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679047195"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-131"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">NettleUMAC</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-identifier hs-type">u</span><span>
</span><a name="line-132"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-133"></a><span>		</span><span class="hs-identifier">update</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">nu_update</span><span>
</span><a name="line-134"></a><span>		</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">nu_Ctx</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">unsafeDupablePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-135"></a><span>			</span><span class="hs-identifier">withSecureMemCopy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nu_ctx</span><span> </span><span class="hs-identifier hs-var">ctx</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-136"></a><span>			</span><span class="hs-identifier">forM_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">L</span><span class="hs-operator">.</span><span class="hs-identifier">toChunks</span><span> </span><span class="hs-identifier">msg</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">chunk</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-137"></a><span>			</span><span class="hs-identifier">withByteStringPtr</span><span> </span><span class="hs-identifier">chunk</span><span> </span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a href="Nettle.Utils.html#withByteStringPtr"><span class="hs-identifier hs-var">chunklen</span></a><span> </span><span class="hs-identifier">chunkptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-138"></a><span>				</span><span class="hs-identifier">update</span><span> </span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-identifier">chunklen</span><span> </span><span class="hs-identifier">chunkptr</span><span>
</span><a name="line-139"></a><span class="hs-identifier">nettleUmacFinalize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="#local-6989586621679047127"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679047127"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679047127"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><a name="nettleUmacFinalize"><a href="Crypto.Nettle.UMAC.html#nettleUmacFinalize"><span class="hs-identifier">nettleUmacFinalize</span></a></a><span> </span><a name="local-6989586621679047205"><a href="#local-6989586621679047205"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">untag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679047206"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679047205"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-141"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">NettleUMAC</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier hs-type">u</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier">ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">u</span><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>	</span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">ctx</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-143"></a><span>		</span><span class="hs-identifier">digestSize</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">nu_digest_size</span><span>
</span><a name="line-144"></a><span>		</span><span class="hs-identifier">digest</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">nu_digest</span><span>
</span><a name="line-145"></a><span>		</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">unsafeDupablePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-146"></a><span>			</span><span class="hs-identifier">ctx'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">secureMemCopy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nu_ctx</span><span> </span><span class="hs-identifier hs-var">ctx</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>			</span><span class="hs-identifier">dig</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withSecureMemPtr</span><span> </span><span class="hs-identifier">ctx'</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier hs-var">ctxptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-148"></a><span>				</span><span class="hs-identifier">B</span><span class="hs-operator">.</span><span class="hs-identifier">create</span><span> </span><span class="hs-identifier">digestSize</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">digestptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-149"></a><span>				</span><span class="hs-identifier">digest</span><span> </span><span class="hs-identifier">ctxptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">digestSize</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">digestptr</span><span>
</span><a name="line-150"></a><span>			</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dig</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nu_Ctx</span><span> </span><span class="hs-identifier">ctx'</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-cpp">#define INSTANCE_UMAC(Typ) \
instance UMAC Typ where \
	{ umacDigestSize = nettleUmacDigestSize \
	; umacInit       = nettleUmacInit \
	; umacSetNonce   = nettleUmacSetNonce \
	; umacUpdate     = nettleUmacUpdate \
	; umacUpdateLazy = nettleUmacUpdateLazy \
	; umacFinalize   = nettleUmacFinalize \
	} ; \
instance KeyedHashAlgorithm Typ where \
	{ implKeyedHashDigestSize = umacKHDigestSize \
	; implKeyedHashName       = umacKHName \
	; implKeyedHashInit       = umacKHInit \
	; implKeyedHashUpdate     = umacKHUpdate \
	; implKeyedHashFinalize   = umacKHFinalize \
	}</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">{-|
'UMAC32' is the 32-bit (4 byte) digest variant. See 'umacInitKeyedHash' for the 'KeyedHashAlgorithm' instance.
-}</span><span>
</span><a name="line-173"></a><span class="hs-keyword">newtype</span><span> </span><a name="UMAC32"><a href="Crypto.Nettle.UMAC.html#UMAC32"><span class="hs-identifier">UMAC32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UMAC32"><a href="Crypto.Nettle.UMAC.html#UMAC32"><span class="hs-identifier">UMAC32</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="umac32_ctx"><a href="Crypto.Nettle.UMAC.html#umac32_ctx"><span class="hs-identifier">umac32_ctx</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SecureMem</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-174"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC32"><span class="hs-identifier hs-type">UMAC32</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>	</span><span class="hs-identifier">nu_ctx_size</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac32_ctx_size</span><span>
</span><a name="line-176"></a><span>	</span><span class="hs-identifier">nu_digest_size</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac32_digest_size</span><span>
</span><a name="line-177"></a><span>	</span><span class="hs-identifier">nu_set_key</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac32_set_key</span><span>
</span><a name="line-178"></a><span>	</span><span class="hs-identifier">nu_set_nonce</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac32_set_nonce</span><span>
</span><a name="line-179"></a><span>	</span><span class="hs-identifier">nu_update</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac32_update</span><span>
</span><a name="line-180"></a><span>	</span><span class="hs-identifier">nu_digest</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac32_digest</span><span>
</span><a name="line-181"></a><span>	</span><span class="hs-identifier">nu_ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">umac32_ctx</span><span>
</span><a name="line-182"></a><span>	</span><span class="hs-identifier">nu_Ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">UMAC32</span><span>
</span><a name="line-183"></a><span class="hs-identifier">INSTANCE_UMAC</span><span class="hs-special">(</span><a href="Crypto.Nettle.UMAC.html#UMAC32"><span class="hs-identifier hs-type">UMAC32</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">{-|
'UMAC64' is the 64-bit (8 byte) digest variant. See 'umacInitKeyedHash' for the 'KeyedHashAlgorithm' instance.
-}</span><span>
</span><a name="line-188"></a><span class="hs-keyword">newtype</span><span> </span><a name="UMAC64"><a href="Crypto.Nettle.UMAC.html#UMAC64"><span class="hs-identifier">UMAC64</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UMAC64"><a href="Crypto.Nettle.UMAC.html#UMAC64"><span class="hs-identifier">UMAC64</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="umac64_ctx"><a href="Crypto.Nettle.UMAC.html#umac64_ctx"><span class="hs-identifier">umac64_ctx</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SecureMem</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-189"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC64"><span class="hs-identifier hs-type">UMAC64</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-190"></a><span>	</span><span class="hs-identifier">nu_ctx_size</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac64_ctx_size</span><span>
</span><a name="line-191"></a><span>	</span><span class="hs-identifier">nu_digest_size</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac64_digest_size</span><span>
</span><a name="line-192"></a><span>	</span><span class="hs-identifier">nu_set_key</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac64_set_key</span><span>
</span><a name="line-193"></a><span>	</span><span class="hs-identifier">nu_set_nonce</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac64_set_nonce</span><span>
</span><a name="line-194"></a><span>	</span><span class="hs-identifier">nu_update</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac64_update</span><span>
</span><a name="line-195"></a><span>	</span><span class="hs-identifier">nu_digest</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac64_digest</span><span>
</span><a name="line-196"></a><span>	</span><span class="hs-identifier">nu_ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">umac64_ctx</span><span>
</span><a name="line-197"></a><span>	</span><span class="hs-identifier">nu_Ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">UMAC64</span><span>
</span><a name="line-198"></a><span class="hs-identifier">INSTANCE_UMAC</span><span class="hs-special">(</span><a href="Crypto.Nettle.UMAC.html#UMAC64"><span class="hs-identifier hs-type">UMAC64</span></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">{-|
'UMAC96' is the 96-bit (12 byte) digest variant. See 'umacInitKeyedHash' for the 'KeyedHashAlgorithm' instance.
-}</span><span>
</span><a name="line-203"></a><span class="hs-keyword">newtype</span><span> </span><a name="UMAC96"><a href="Crypto.Nettle.UMAC.html#UMAC96"><span class="hs-identifier">UMAC96</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UMAC96"><a href="Crypto.Nettle.UMAC.html#UMAC96"><span class="hs-identifier">UMAC96</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="umac96_ctx"><a href="Crypto.Nettle.UMAC.html#umac96_ctx"><span class="hs-identifier">umac96_ctx</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SecureMem</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-204"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC96"><span class="hs-identifier hs-type">UMAC96</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-205"></a><span>	</span><span class="hs-identifier">nu_ctx_size</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac96_ctx_size</span><span>
</span><a name="line-206"></a><span>	</span><span class="hs-identifier">nu_digest_size</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac96_digest_size</span><span>
</span><a name="line-207"></a><span>	</span><span class="hs-identifier">nu_set_key</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac96_set_key</span><span>
</span><a name="line-208"></a><span>	</span><span class="hs-identifier">nu_set_nonce</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac96_set_nonce</span><span>
</span><a name="line-209"></a><span>	</span><span class="hs-identifier">nu_update</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac96_update</span><span>
</span><a name="line-210"></a><span>	</span><span class="hs-identifier">nu_digest</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac96_digest</span><span>
</span><a name="line-211"></a><span>	</span><span class="hs-identifier">nu_ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">umac96_ctx</span><span>
</span><a name="line-212"></a><span>	</span><span class="hs-identifier">nu_Ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">UMAC96</span><span>
</span><a name="line-213"></a><span class="hs-identifier">INSTANCE_UMAC</span><span class="hs-special">(</span><a href="Crypto.Nettle.UMAC.html#UMAC96"><span class="hs-identifier hs-type">UMAC96</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">{-|
'UMAC128' is the 128-bit (16 byte) digest variant. See 'umacInitKeyedHash' for the 'KeyedHashAlgorithm' instance.
-}</span><span>
</span><a name="line-218"></a><span class="hs-keyword">newtype</span><span> </span><a name="UMAC128"><a href="Crypto.Nettle.UMAC.html#UMAC128"><span class="hs-identifier">UMAC128</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UMAC128"><a href="Crypto.Nettle.UMAC.html#UMAC128"><span class="hs-identifier">UMAC128</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="umac128_ctx"><a href="Crypto.Nettle.UMAC.html#umac128_ctx"><span class="hs-identifier">umac128_ctx</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SecureMem</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-219"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Nettle.UMAC.html#NettleUMAC"><span class="hs-identifier hs-type">NettleUMAC</span></a><span> </span><a href="Crypto.Nettle.UMAC.html#UMAC128"><span class="hs-identifier hs-type">UMAC128</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-220"></a><span>	</span><span class="hs-identifier">nu_ctx_size</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac128_ctx_size</span><span>
</span><a name="line-221"></a><span>	</span><span class="hs-identifier">nu_digest_size</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac128_digest_size</span><span>
</span><a name="line-222"></a><span>	</span><span class="hs-identifier">nu_set_key</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac128_set_key</span><span>
</span><a name="line-223"></a><span>	</span><span class="hs-identifier">nu_set_nonce</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac128_set_nonce</span><span>
</span><a name="line-224"></a><span>	</span><span class="hs-identifier">nu_update</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac128_update</span><span>
</span><a name="line-225"></a><span>	</span><span class="hs-identifier">nu_digest</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Tagged</span><span> </span><span class="hs-identifier">c_umac128_digest</span><span>
</span><a name="line-226"></a><span>	</span><span class="hs-identifier">nu_ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">umac128_ctx</span><span>
</span><a name="line-227"></a><span>	</span><span class="hs-identifier">nu_Ctx</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">UMAC128</span><span>
</span><a name="line-228"></a><span class="hs-identifier">INSTANCE_UMAC</span><span class="hs-special">(</span><a href="Crypto.Nettle.UMAC.html#UMAC128"><span class="hs-identifier hs-type">UMAC128</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a></pre></body></html>